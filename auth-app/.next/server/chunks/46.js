"use strict";exports.id=46,exports.ids=[46],exports.modules={9046:(e,t,r)=>{r.d(t,{createKyselyAdapter:()=>l.t,kyselyAdapter:()=>a});var l=r(4972);r(2746),r(7679),r(1282),r(5196),r(904);var i=r(6294),n=r(469);let a=(e,t)=>{let r=null,l=e=>({getFieldName:r,schema:l,getDefaultFieldName:i,getDefaultModelName:a,getFieldAttributes:o,getModelName:s})=>{let d=e=>{let t=[],r=[];if(e)for(let[i,o]of Object.entries(e)){let e=l[a(i)]?.fields,[o,s]=i.includes(".")?i.split("."):[void 0,i];if(e)for(let[l,a]of(e.id={type:"string"},Object.entries(e)))t.push((0,n.i)`${n.i.ref(`join_${s}`)}.${n.i.ref(a.fieldName||l)} as ${n.i.ref(`_joined_${s}_${a.fieldName||l}`)}`),r.push({joinModel:i,joinModelRef:s,fieldName:a.fieldName||l})}return{allSelectsStr:r,allSelects:t}},u=async(l,i,n,a)=>{if(t?.type==="mysql"){await i.execute();let t=l.id?"id":a.length>0&&a[0]?.field?a[0].field:"id";if(!l.id&&0===a.length)return await e.selectFrom(n).selectAll().orderBy(r({model:n,field:t}),"desc").limit(1).executeTakeFirst();let o=l[t]||a[0]?.value;return await e.selectFrom(n).selectAll().orderBy(r({model:n,field:t}),"desc").where(r({model:n,field:t}),"=",o).limit(1).executeTakeFirst()}return t?.type==="mssql"?await i.outputAll("inserted").executeTakeFirst():await i.returningAll().executeTakeFirst()};function f(e,t){if(!t)return{and:null,or:null};let l={and:[],or:[]};return t.forEach(t=>{let{field:i,value:n,operator:a="=",connector:o="AND"}=t,s=r({model:e,field:i}),d=t=>{let r=`${e}.${s}`;return"in"===a.toLowerCase()?t(r,"in",Array.isArray(n)?n:[n]):"not_in"===a.toLowerCase()?t(r,"not in",Array.isArray(n)?n:[n]):"contains"===a?t(r,"like",`%${n}%`):"starts_with"===a?t(r,"like",`${n}%`):"ends_with"===a?t(r,"like",`%${n}`):t(r,"eq"===a?"=":"ne"===a?"<>":"gt"===a?">":"gte"===a?">=":"lt"===a?"<":"lte"===a?"<=":a,n)};"OR"===o?l.or.push(d):l.and.push(d)}),{and:l.and.length?l.and:null,or:l.or.length?l.or:null}}function c(e,t,l){if(!t||!e.length)return e;let i=new Map;for(let n of e){let e={},a={};for(let[e]of Object.entries(t))a[s(e)]={};for(let[t,i]of Object.entries(n)){let n=String(t),o=!1;for(let{joinModel:e,fieldName:t,joinModelRef:d}of l)if(n===`_joined_${d}_${t}`){a[s(e)][r({model:e,field:t})]=i,o=!0;break}o||(e[t]=i)}let o=e.id;if(!o)continue;if(!i.has(o)){let r={...e};for(let[e,l]of Object.entries(t))r[s(e)]="one-to-one"===l.relation?null:[];i.set(o,r)}let d=i.get(o);for(let[e,l]of Object.entries(t)){let t="one-to-one"===l.relation,i=l.limit??100,n=a[s(e)],o=n&&Object.keys(n).length>0&&Object.values(n).some(e=>null!=e);if(t)d[s(e)]=o?n:null;else{let t=s(e);if(Array.isArray(d[t])&&o){if(d[t].length>=i)continue;let l=r({model:e,field:"id"}),a=n[l];a?!d[t].some(e=>e[l]===a)&&d[t].length<i&&d[t].push(n):d[t].length<i&&d[t].push(n)}}}}let n=Array.from(i.values());for(let e of n)for(let[r,l]of Object.entries(t))if("one-to-one"!==l.relation){let t=s(r);if(Array.isArray(e[t])){let r=l.limit??100;e[t].length>r&&(e[t]=e[t].slice(0,r))}}return n}return{create:async({data:t,model:r})=>await u(t,e.insertInto(r).values(t),r,[]),async findOne({model:t,where:r,select:l,join:i}){let{and:n,or:a}=f(t,r),o=e.selectFrom(e=>{let r=e.selectFrom(t);return n&&(r=r.where(e=>e.and(n.map(t=>t(e))))),a&&(r=r.where(e=>e.or(a.map(t=>t(e))))),r.selectAll().as("primary")}).selectAll("primary");if(i)for(let[e,t]of Object.entries(i)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];o=o.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:s,allSelects:u}=d(i);o=o.select(u);let p=await o.execute();if(!p||!Array.isArray(p)||0===p.length)return null;let y=p[0];return i?c(p,i,s)[0]:y},async findMany({model:l,where:i,limit:n,offset:a,sortBy:o,join:s}){let{and:u,or:p}=f(l,i),y=e.selectFrom(e=>{let i=e.selectFrom(l);return t?.type==="mssql"?void 0!==a?(o||(i=i.orderBy(r({model:l,field:"id"}))),i=i.offset(a).fetch(n||100)):void 0!==n&&(i=i.top(n)):(void 0!==n&&(i=i.limit(n)),void 0!==a&&(i=i.offset(a))),o?.field&&(i=i.orderBy(`${r({model:l,field:o.field})}`,o.direction)),u&&(i=i.where(e=>e.and(u.map(t=>t(e))))),p&&(i=i.where(e=>e.or(p.map(t=>t(e))))),i.selectAll().as("primary")}).selectAll("primary");if(s)for(let[e,t]of Object.entries(s)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];y=y.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:m,allSelects:h}=d(s);y=y.select(h),o?.field&&(y=y.orderBy(`${r({model:l,field:o.field})}`,o.direction));let w=await y.execute();return w?s?c(w,s,m):w:[]},async update({model:t,where:r,update:l}){let{and:i,or:n}=f(t,r),a=e.updateTable(t).set(l);return i&&(a=a.where(e=>e.and(i.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e))))),await u(l,a,t,r)},async updateMany({model:t,where:r,update:l}){let{and:i,or:n}=f(t,r),a=e.updateTable(t).set(l);return i&&(a=a.where(e=>e.and(i.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e))))),(await a.execute()).length},async count({model:t,where:r}){let{and:l,or:i}=f(t,r),n=e.selectFrom(t).select(e.fn.count("id").as("count"));l&&(n=n.where(e=>e.and(l.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e)))));let a=await n.execute();return"number"==typeof a[0].count?a[0].count:"bigint"==typeof a[0].count?Number(a[0].count):parseInt(a[0].count)},async delete({model:t,where:r}){let{and:l,or:i}=f(t,r),n=e.deleteFrom(t);l&&(n=n.where(e=>e.and(l.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e))))),await n.execute()},async deleteMany({model:t,where:r}){let{and:l,or:i}=f(t,r),n=e.deleteFrom(t);return l&&(n=n.where(e=>e.and(l.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e))))),(await n.execute()).length},options:t}},a=null;a={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:!!(t?.type!=="sqlite"&&t?.type!=="mssql"&&t?.type!=="mysql"&&t?.type),supportsDates:!!(t?.type!=="sqlite"&&t?.type!=="mssql"&&t?.type),supportsJSON:!1,supportsUUIDs:t?.type==="postgres",transaction:!!t?.transaction&&(t=>e.transaction().execute(e=>t((0,i.t)({config:a.config,adapter:l(e)})(r))))},adapter:l(e)};let o=(0,i.t)(a);return e=>(r=e,o(e))}}};